<!DOCTYPE html>
<html lang="mn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PRIME — Competitive Matchmaking Prototype</title>
  <style>
    :root{--bg1:#0b0f1a;--accent:#ff6b6b;--card:#0f1724;--muted:#9aa4b2}
    *{box-sizing:border-box;font-family:Inter, Poppins, system-ui, Arial}
    body{margin:0;background:linear-gradient(180deg,#071026 0%, #081124 60%);color:#e6eef8}
    .wrap{max-width:1100px;margin:28px auto;padding:24px}

    header{display:flex;align-items:center;gap:18px}
    .logo{font-weight:700;font-size:20px;color:var(--accent)}
    nav{margin-left:auto;display:flex;gap:12px}
    nav button{background:transparent;border:1px solid rgba(255,255,255,0.06);color:#dbe8ff;padding:8px 12px;border-radius:10px;cursor:pointer}

    .grid{display:grid;grid-template-columns:320px 1fr;gap:20px;margin-top:22px}

    /* left */
    .panel{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:16px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
    .profile{display:flex;gap:12px;align-items:center}
    .avatar{width:64px;height:64px;border-radius:10px;background:linear-gradient(135deg,#1f2a44,#2a1f4a);display:flex;align-items:center;justify-content:center;font-weight:700}
    .meta small{display:block;color:var(--muted)}

    .queue{margin-top:18px}
    .queue button{width:100%;padding:12px;border-radius:10px;border:0;background:var(--accent);color:#071026;font-weight:700;cursor:pointer}

    .rating{margin-top:14px;padding:10px;background:rgba(255,255,255,0.02);border-radius:10px;text-align:center}
    .rating b{display:block;font-size:20px}

    /* main */
    .main-top{display:flex;justify-content:space-between;gap:12px}
    .search{flex:1;margin-right:12px}
    .search input{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    .create{padding:12px 16px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.06);cursor:pointer}

    .matches{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:12px;margin-top:16px}
    .match{background:var(--card);padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
    .match h4{margin:6px 0}
    .match p{color:var(--muted);font-size:13px}
    .match .join{margin-top:10px;padding:8px;border-radius:8px;background:var(--accent);color:#071026;border:0;cursor:pointer}

    .leaderboard{margin-top:18px}
    .leaderboard h3{margin:8px 0}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px;text-align:left;border-bottom:1px dashed rgba(255,255,255,0.02)}
    td.rank{width:48px}

    /* small */
    .muted{color:var(--muted);font-size:13px}

    footer{margin-top:26px;text-align:center;color:var(--muted);font-size:13px}

    /* modal */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,6,23,0.6)}
    .modal .box{width:520px;background:#071127;padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
    .modal.show{display:flex}

    @media(max-width:880px){.grid{grid-template-columns:1fr}.wrap{padding:12px}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">PRIME</div>
      <div class="muted">Competitive matchmaking prototype</div>
      <nav>
        <button id="btn-leader">Leaderboard</button>
        <button id="btn-tourn">Tournaments</button>
        <button id="btn-help">Тусламж</button>
      </nav>
    </header>

    <div class="grid">
      <div>
        <div class="panel">
          <div class="profile">
            <div class="avatar" id="userAvatar">UC</div>
            <div class="meta">
              <div id="userName">CEzZ</div>
              <small class="muted">Улаанбаатар • Provisional</small>
            </div>
          </div>

          <div class="rating">
            <div class="muted">Rating</div>
            <b id="userRating">1200</b>
            <div class="muted" style="font-size:12px">Wins: <span id="wins">0</span> • Losses: <span id="losses">0</span></div>
          </div>

          <div class="queue">
            <button id="toggleQueue">Join Queue</button>
            <div style="margin-top:12px" class="muted">Оролцогчид: <span id="qCount">0</span></div>
          </div>

          <div style="margin-top:14px" class="muted">Товч:
            <ul style="margin:8px 0 0 16px">
              <li>Simple ELO оснолд суурилсан</li>
              <li>Автомат үйл явц — 2 тоглогч хооронд тааруулна</li>
              <li>Жишээ Back-end: Node.js + Socket.io</li>
            </ul>
          </div>
        </div>
      </div>

      <main>
        <div class="panel">
          <div class="main-top">
            <div class="search"><input id="search" placeholder="Хайх: тоглогч эсвэл тоглолт"/></div>
            <button class="create" id="openCreate">Create Match</button>
          </div>

          <div class="matches" id="matches"></div>

          <div class="leaderboard panel" id="leaderboard">
            <h3>Топ тоглогчид</h3>
            <table>
              <thead><tr><th></th><th>Нэр</th><th>Rating</th><th>W/L</th></tr></thead>
              <tbody id="lbBody"></tbody>
            </table>
          </div>
        </div>
      </main>
    </div>

    <footer>© 2025 PRIME prototype </footer>
  </div>

  <!-- modal -->
  <div class="modal" id="modal">
    <div class="box">
      <h3 id="modalTitle">Тоглолт үүсгэх</h3>
      <div style="margin-top:8px">
        <label class="muted">Тоглогчын тоо:</label>
        <select id="pcount" style="margin-left:8px;padding:8px;border-radius:8px;background:#0b1420;border:1px solid rgba(255,255,255,0.03)">
          <option>2</option>
          <option>4</option>
        </select>
      </div>
      <div style="margin-top:12px;text-align:right">
        <button id="closeModal" style="margin-right:8px;padding:8px 12px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04)">Хаах</button>
        <button id="createBtn" style="padding:8px 12px;border-radius:8px;background:var(--accent);border:0;color:#071026">Үүсгэх</button>
      </div>
    </div>
  </div>

  <script>
    // Sample users (would come from server in real app)
    const users = [
      {id:1,name:'CEzZ',rating:2100,w:0,l:0},
      {id:2,name:'Lone2k',rating:1995,w:10,l:4},
      {id:3,name:'Mitee',rating:1900,w:8,l:6},
      {id:4,name:'Hypexl',rating:1800,w:32,l:12},
      {id:5,name:'yusi',rating:1810,w:21,l:9}
    ];

    let queue = [];

    function renderMatches(){
      const container = document.getElementById('matches');container.innerHTML='';
      // show open matches (for prototype we'll show sample freerooms)
      for(let i=0;i<3;i++){
        const div = document.createElement('div');div.className='match';
        div.innerHTML=`<div style="display:flex;justify-content:space-between;align-items:center"><div><h4>Quick Match ${i+1}</h4><p>Open 1v1 • Avg rating 1200-1400</p></div><button class='join' data-room='qm${i}'>Join</button></div>`
        container.appendChild(div);
      }
      // wire buttons
      container.querySelectorAll('.join').forEach(btn=>btn.onclick=()=>{
        const room=btn.dataset.room;joinQueue('Quick');
      })
    }

    function renderLeaderboard(){
      const body = document.getElementById('lbBody');body.innerHTML='';
      const sorted = users.slice().sort((a,b)=>b.rating-a.rating);
      sorted.forEach((u,idx)=>{
        const tr=document.createElement('tr');tr.innerHTML=`<td class='rank'>#${idx+1}</td><td>${u.name}</td><td>${u.rating}</td><td>${u.w}/${u.l}</td>`;
        body.appendChild(tr);
      });
    }

    function joinQueue(type){
      const me = users[0];
      if(queue.find(q=>q.id===me.id)) return alert('Та өмнө нь зурсан байна');
      queue.push(me);updateQueueUI();
      // try matchmake
      attemptMatch();
    }

    function updateQueueUI(){
      document.getElementById('qCount').innerText=queue.length;
      document.getElementById('userRating').innerText=users[0].rating;
      document.getElementById('wins').innerText=users[0].w;
      document.getElementById('losses').innerText=users[0].l;
      document.getElementById('toggleQueue').innerText = queue.find(q=>q.id===users[0].id)?'Leave Queue':'Join Queue';
    }

    function attemptMatch(){
      if(queue.length<2) return; // need at least two
      // simple pair: take first two closest by rating
      let a = queue.shift();
      // find best match for a
      let bestIdx = 0; let bestDiff = Math.abs(queue[0].rating - a.rating);
      for(let i=1;i<queue.length;i++){const diff=Math.abs(queue[i].rating-a.rating);if(diff<bestDiff){bestDiff=diff;bestIdx=i}}
      const b = queue.splice(bestIdx,1)[0];
      simulateMatch(a,b);
      updateQueueUI();
    }

    // Simple ELO update and simulated result
    function simulateMatch(a,b){
      // probability
      const pa = 1/(1+Math.pow(10, (b.rating-a.rating)/400));
      const ra = Math.random() < pa ? 1 : 0; // 1 means a wins
      // K-factor
      const K = 32;
      const newA = Math.round(a.rating + K*(ra - pa));
      const newB = Math.round(b.rating + K*((1-ra) - (1-pa)));

      // update users array
      updateUserRating(a.id,newA,ra);
      updateUserRating(b.id,newB,1-ra);

      // notify
      showResultModal(a,b,ra,newA,newB);
    }

    function updateUserRating(id,newRating,win){
      const u = users.find(x=>x.id===id); if(!u) return;
      if(win){u.w = (u.w||0)+1}else{u.l=(u.l||0)+1}
      u.rating=newRating;
    }

    function showResultModal(a,b,awin,newA,newB){
      const modal=document.getElementById('modal');modal.classList.add('show');
      document.getElementById('modalTitle').innerText = `Матч үр дүн — ${a.name} vs ${b.name}`;
      document.querySelector('.box').querySelector('div').innerHTML = `
        <div style="margin-top:8px">
          <div><strong>${a.name}</strong> шинэ рейтинг: ${newA} (${awin? 'WIN':'LOSS'})</div>
          <div style=\"margin-top:6px\"><strong>${b.name}</strong> шинэ рейтинг: ${newB} (${awin? 'LOSS':'WIN'})</div>
        </div>`;
      renderLeaderboard();
    }

    // UI wiring
    document.getElementById('toggleQueue').onclick = ()=>{
      const inQ = queue.find(q=>q.id===users[0].id);
      if(inQ){queue = queue.filter(q=>q.id!==users[0].id);updateQueueUI()}else{joinQueue('quick')}
    }

    document.getElementById('openCreate').onclick = ()=>{document.getElementById('modal').classList.add('show')}
    document.getElementById('closeModal').onclick = ()=>{document.getElementById('modal').classList.remove('show')}
    document.getElementById('createBtn').onclick = ()=>{alert('Match created (prototype) — сервер хэрэгтэй)');document.getElementById('modal').classList.remove('show')}

    // init
    renderMatches();renderLeaderboard();updateQueueUI();
  </script>
</body>
</html>
